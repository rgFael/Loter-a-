<!DOCTYPE html>

<html lang="es">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Lotería Pokéonedas</title>

    

    <!-- Tailwind CSS -->

    <script src="https://cdn.tailwindcss.com"></script>

    

    <!-- React y ReactDOM -->

    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>

    

    <!-- Google Fonts -->

    <style>

        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=VT323&display=swap');

        :root {

            --poke-red: #ff3a3a;

            --poke-dark: #2d2d2d;

            --coin-gold: #fbbf24;

            --coin-shadow: #b45309;

        }

        body {

            font-family: 'Fredoka', sans-serif;

            background-color: #202020;

            background-image: 

                radial-gradient(#333 15%, transparent 16%),

                radial-gradient(#333 15%, transparent 16%);

            background-size: 20px 20px;

            background-position: 0 0, 10px 10px;

            color: var(--poke-dark);

            overflow-x: hidden;

            touch-action: pan-y;

            -webkit-tap-highlight-color: transparent;

            /* BLOQUEO DE SELECCIÓN DE TEXTO */

            -webkit-user-select: none; /* Safari */

            -ms-user-select: none; /* IE 10 and IE 11 */

            user-select: none; /* Standard syntax */

        }

        .font-pixel { font-family: 'VT323', monospace; }

        

        /* --- Animaciones --- */

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }

        @keyframes scaleUp { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }

        .animate-scale-up { animation: scaleUp 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }

        

        @keyframes knobSpin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .animate-knob-spin { animation: knobSpin 0.5s ease-out 1; }

        /* ANIMACIÓN CORREGIDA: Ticket saliendo de la rejilla */

        @keyframes ticketEject {

            0% { transform: translateY(-120%); opacity: 0; } /* Empieza más arriba escondido */

            40% { transform: translateY(10%); opacity: 1; }

            60% { transform: translateY(0%); }

            100% { transform: translateY(20%); } /* Se queda un poco afuera */

        }

        .animate-ticket-eject { animation: ticketEject 0.8s cubic-bezier(0.25, 1, 0.5, 1) forwards; }

        /* NUEVA: El ticket vuela hacia la pantalla */

        @keyframes ticketFlyToScreen {

            0% { transform: scale(0.2) translateY(300px); opacity: 0; }

            100% { transform: scale(1) translateY(0); opacity: 1; }

        }

        .animate-fly-in { animation: ticketFlyToScreen 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }

        @keyframes revealPulse {

            0% { transform: scale(1); filter: brightness(1); }

            50% { transform: scale(1.05); filter: brightness(1.2); }

            100% { transform: scale(1); filter: brightness(1); }

        }

        .animate-reveal { animation: revealPulse 0.5s ease-out; }

        /* Estilos Gacha */

        .glass-dome {

            background: rgba(255, 255, 255, 0.2);

            border: 3px solid rgba(255,255,255,0.4);

            box-shadow: inset 10px 10px 20px rgba(255,255,255,0.3), inset -10px -10px 20px rgba(0,0,0,0.1);

            backdrop-filter: blur(1px);

        }

        

        .capsule {

            border: 2px solid rgba(0,0,0,0.1);

            background: linear-gradient(135deg, #ff5f6d 0%, #ffc371 100%);

            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);

        }

        .capsule::after {

            content: '';

            position: absolute;

            top: 50%;

            left: 50%;

            transform: translate(-50%, -50%);

            width: 100%;

            height: 2px;

            background: rgba(0,0,0,0.1);

        }

        

        .capsule.blue { background: linear-gradient(135deg, #2193b0 0%, #6dd5ed 100%); }

        .capsule.yellow { background: linear-gradient(135deg, #fceabb 0%, #f8b500 100%); }

        

        /* Estilo para la Rejilla de salida */

        .ticket-slot {

            background: repeating-linear-gradient(

                90deg,

                #1a202c,

                #1a202c 10px,

                #2d3748 10px,

                #2d3748 12px

            );

            box-shadow: inset 0 2px 5px rgba(0,0,0,0.8);

            position: relative;

            overflow: visible; /* Importante para que salga el ticket */

        }

        

        /* Máscara superior para que el ticket no se vea antes de salir */

        .ticket-slot-mask {

            position: absolute;

            top: -60px; /* Ajustado para cubrir la zona de spawn */

            left: 0;

            width: 100%;

            height: 60px;

            background: #dc2626; /* Mismo color que la máquina (red-600) */

            z-index: 15;

        }

    </style>

</head>

<body>

    <div id="root"></div>

    <script type="text/babel">

        const { useState, useEffect, useRef } = React;

        // --- ICONOS SVG ACTUALIZADOS ---

        const SVGIcons = {

            BagOfCoins: ({className}) => (

                <svg viewBox="0 0 24 24" fill="none" className={className} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">

                    <path d="M12 2C9 2 7 4 7 6v2h10V6c0-2-2-4-5-4z" className="fill-yellow-600 text-yellow-800"/>

                    <path d="M5 8h14c1.1 0 2 .9 2 2v10c0 1.1-.9 2-2 2H5c-1.1 0-2-.9-2-2V10c0-1.1.9-2 2-2z" className="fill-yellow-400 text-yellow-700"/>

                    <circle cx="12" cy="15" r="3" className="fill-yellow-300 text-yellow-600"/>

                </svg>

            ),

            // Pila grande (5k)

            CoinPileHuge: ({className}) => (

                <svg viewBox="0 0 24 24" fill="none" className={className} stroke="currentColor" strokeWidth="1.5">

                    <circle cx="9" cy="18" r="4" className="fill-yellow-400 text-yellow-700"/>

                    <circle cx="15" cy="18" r="4" className="fill-yellow-400 text-yellow-700"/>

                    <circle cx="12" cy="14" r="4" className="fill-yellow-300 text-yellow-600"/>

                    <circle cx="12" cy="6" r="4" className="fill-yellow-200 text-yellow-500"/>

                </svg>

            ),

            // Pirámide (7k) - Nuevo icono

            CoinPilePyramid: ({className}) => (

                <svg viewBox="0 0 24 24" fill="none" className={className} stroke="currentColor" strokeWidth="1.5">

                    <path d="M4 19h16" strokeWidth="2" className="text-yellow-800"/>

                    <circle cx="6" cy="16" r="3" className="fill-yellow-500 text-yellow-800"/>

                    <circle cx="12" cy="16" r="3" className="fill-yellow-500 text-yellow-800"/>

                    <circle cx="18" cy="16" r="3" className="fill-yellow-500 text-yellow-800"/>

                    <circle cx="9" cy="11" r="3" className="fill-yellow-400 text-yellow-700"/>

                    <circle cx="15" cy="11" r="3" className="fill-yellow-400 text-yellow-700"/>

                    <circle cx="12" cy="6" r="3" className="fill-yellow-300 text-yellow-600"/>

                </svg>

            ),

            CoinPileMedium: ({className}) => (

                <svg viewBox="0 0 24 24" fill="none" className={className} stroke="currentColor" strokeWidth="1.5">

                    <circle cx="8" cy="18" r="4" className="fill-yellow-400 text-yellow-700"/>

                    <circle cx="16" cy="18" r="4" className="fill-yellow-400 text-yellow-700"/>

                    <circle cx="12" cy="12" r="4" className="fill-yellow-300 text-yellow-600"/>

                </svg>

            ),

            CoinPileSmall: ({className}) => (

                <svg viewBox="0 0 24 24" fill="none" className={className} stroke="currentColor" strokeWidth="1.5">

                    <circle cx="10" cy="16" r="5" className="fill-yellow-400 text-yellow-700"/>

                    <circle cx="14" cy="10" r="5" className="fill-yellow-300 text-yellow-600"/>

                </svg>

            ),

            CoinSingle: ({className}) => (

                <svg viewBox="0 0 24 24" fill="none" className={className} stroke="currentColor" strokeWidth="2">

                    <circle cx="12" cy="12" r="9" className="fill-yellow-400 text-yellow-700"/>

                    <path d="M12 8v8M9 10l6 4M9 14l6-4" className="text-yellow-700"/>

                </svg>

            ),

            CoinSilver: ({className}) => (

                <svg viewBox="0 0 24 24" fill="none" className={className} stroke="currentColor" strokeWidth="2">

                    <circle cx="12" cy="12" r="9" className="fill-gray-200 text-gray-500"/>

                    <path d="M12 7v10" className="text-gray-400"/>

                </svg>

            ),

            // Jackpot: ESTRELLA SIN CÍRCULO EN MEDIO

            Jackpot: ({className}) => (

                <svg viewBox="0 0 24 24" fill="none" className={className} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">

                     <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" className="fill-yellow-300 text-yellow-600 animate-pulse" />

                </svg>

            ),

            EmptyBox: ({className}) => (

                <svg viewBox="0 0 24 24" fill="none" className={className} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">

                    <path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z" className="text-slate-400 fill-slate-100"/>

                    <path d="M12 12v10"/>

                    <path d="m3.3 7 8.7 5 8.7-5"/>

                    <path d="M16 14l-4 4-4-4" className="text-red-400"/>

                </svg>

            ),

            Ticket: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="18" height="12" x="3" y="6" rx="2"/><path d="M3 10h18"/><path d="M8 18v-2"/><path d="M16 18v-2"/></svg>,

            Sparkles: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M3 5h4"/><path d="M3 9h4"/></svg>,

            Settings: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.78 1.48a2 2 0 0 0 .73 2.73l.15.08a2 2 0 0 1 1 1.73v.52a2 2 0 0 1-1 1.73l-.15.08a2 2 0 0 0-.73 2.73l.78 1.48a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.78-1.48a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.73v-.52a2 2 0 0 1 1-1.73l.15-.08a2 2 0 0 0 .73-2.73l-.78-1.48a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>,

            Trash2: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>,

        };

        // --- CONFIGURACIÓN DE PREMIOS ---

        const PRIZE_TIERS = [

            { label: '¡PREMIO MAYOR!', value: 'JACKPOT', amount: 0, Icon: SVGIcons.Jackpot, color: 'bg-gradient-to-br from-yellow-200 to-yellow-400 border-4 border-yellow-600', textColor: 'text-yellow-800' },

            { label: '10,000 MONEDAS', value: 10000, amount: 10000, Icon: SVGIcons.BagOfCoins, color: 'bg-purple-100 border-4 border-purple-500', textColor: 'text-purple-700' },

            { label: '7,000 MONEDAS', value: 7000, amount: 7000, Icon: SVGIcons.CoinPilePyramid, color: 'bg-blue-100 border-4 border-blue-500', textColor: 'text-blue-700' },

            { label: '5,000 MONEDAS', value: 5000, amount: 5000, Icon: SVGIcons.CoinPileHuge, color: 'bg-green-100 border-4 border-green-500', textColor: 'text-green-700' },

            { label: '3,000 MONEDAS', value: 3000, amount: 3000, Icon: SVGIcons.CoinPileMedium, color: 'bg-orange-100 border-4 border-orange-500', textColor: 'text-orange-700' },

            { label: '1,000 MONEDAS', value: 1000, amount: 1000, Icon: SVGIcons.CoinPileSmall, color: 'bg-amber-100 border-4 border-amber-500', textColor: 'text-amber-800' },

            { label: '500 MONEDAS', value: 500, amount: 500, Icon: SVGIcons.CoinSingle, color: 'bg-yellow-50 border-4 border-yellow-400', textColor: 'text-yellow-600' },

            { label: '100 MONEDAS', value: 100, amount: 100, Icon: SVGIcons.CoinSilver, color: 'bg-gray-100 border-4 border-gray-400', textColor: 'text-gray-500' },

            { label: 'Vacío', value: 0, amount: 0, Icon: SVGIcons.EmptyBox, color: 'bg-slate-50 border-4 border-slate-300', textColor: 'text-slate-400' },

        ];

        

        const INITIAL_PROBABILITIES = {

            'JACKPOT': 0.05, 10000: 0.2, 7000: 0.5, 5000: 1.0, 3000: 2.5, 1000: 5.0, 500: 8.0, 100: 15.0, 0: 67.75

        };

        // --- LÓGICA DE SORTEO ---

        const drawTicketByProbability = (probabilities, jackpotAmount) => {

            const tiersWithProb = PRIZE_TIERS.map(tier => {

                const probability = probabilities[tier.value] || 0;

                return { ...tier, probability };

            });

            const totalWeight = tiersWithProb.reduce((sum, tier) => sum + tier.probability, 0);

            let randomNum = Math.random() * totalWeight;

            for (const tier of tiersWithProb) {

                if (randomNum < tier.probability) {

                    return { 

                        ...tier, 

                        amount: tier.value === 'JACKPOT' ? jackpotAmount : tier.amount,

                        id: Date.now() + Math.floor(Math.random() * 1000), 

                        number: Math.floor(1000 + Math.random() * 9000).toString(),

                    };

                }

                randomNum -= tier.probability;

            }

            return tiersWithProb.find(t => t.value === 0);

        };

        // --- APP ---

        function App() {

            const [gameState, setGameState] = useState('LOADING'); 

            const [jackpot, setJackpot] = useState(0);

            const [isSecretMode, setIsSecretMode] = useState(false); // Nuevo: controla si es random/secreto

            const [jackpotRevealed, setJackpotRevealed] = useState(false);

            const [probabilities, setProbabilities] = useState(INITIAL_PROBABILITIES);

            const [currentTicket, setCurrentTicket] = useState(null);

            const [isDrawing, setIsDrawing] = useState(false);

            

            useEffect(() => {

                const savedData = localStorage.getItem('pokegacha_pro_v3');

                if (savedData) {

                    try {

                        const parsed = JSON.parse(savedData);

                        setJackpot(parsed.jackpot || 0);

                        setProbabilities(parsed.probabilities || INITIAL_PROBABILITIES);

                        setJackpotRevealed(parsed.jackpotRevealed || false);

                        setIsSecretMode(parsed.isSecretMode || false);

                        if (parsed.jackpot > 0) setGameState('PLAYING');

                        else setGameState('SETUP');

                    } catch (e) { setGameState('SETUP'); }

                } else { setGameState('SETUP'); }

            }, []);

            useEffect(() => {

                if (gameState !== 'LOADING') {

                    localStorage.setItem('pokegacha_pro_v3', JSON.stringify({ jackpot, probabilities, jackpotRevealed, isSecretMode }));

                }

            }, [jackpot, probabilities, gameState, jackpotRevealed, isSecretMode]);

            const handleStartGeneration = (amount, isRandom) => {

                const finalAmount = isRandom 

                    ? Math.floor(Math.random() * (1000000 - 100000 + 1)) + 100000 

                    : parseInt(amount);

                

                setJackpot(finalAmount);

                // Si es Random, el modo es secreto (true). Si es manual, no es secreto (false).

                setIsSecretMode(isRandom);

                // Si es Manual, "revelado" empieza en true para que se vea. Si es Random, false.

                setJackpotRevealed(!isRandom);

                

                setGameState('PLAYING'); 

            };

            

            const drawTicket = () => {

                if (isDrawing) return;

                setIsDrawing(true);

                

                // 1. Inicia animación de perilla

                setTimeout(() => {

                    const newTicket = drawTicketByProbability(probabilities, jackpot);

                    setCurrentTicket(newTicket);

                    

                    // IMPORTANTE: NO revelamos el jackpot aquí todavía para evitar spoiler

                    // 2. El ticket sale (retraso para que coincida con animación)

                    setTimeout(() => {

                        setGameState('SCRATCHING');

                        setIsDrawing(false);

                    }, 1200); 

                }, 500); 

            };

            const finishScratch = () => {

                // Aquí es donde revelamos el jackpot en la pantalla principal si el ticket era el ganador

                if (currentTicket.value === 'JACKPOT') {

                    setJackpotRevealed(true);

                }

                setGameState('RESULT');

            };

            const closeResult = () => {

                setCurrentTicket(null);

                setGameState('PLAYING');

            };

            const resetAll = () => {

                if(window.confirm("¿Reiniciar sistema?")){ 

                    localStorage.removeItem('pokegacha_pro_v3');

                    setGameState('SETUP');

                    setJackpot(0);

                    setJackpotRevealed(false);

                    setIsSecretMode(false);

                    setProbabilities(INITIAL_PROBABILITIES);

                }

            };

            

            const getTicketTier = (value) => PRIZE_TIERS.find(t => t.value === value);

            if (gameState === 'LOADING') return <div className="min-h-screen bg-red-600 flex items-center justify-center text-white font-bold text-xl font-pixel">Cargando Sistema...</div>;

            return (

                <div className="min-h-screen font-sans flex justify-center py-0 md:py-8 bg-slate-900">

                    {/* Marco del Pokédex */}

                    <div className="w-full max-w-md bg-red-600 min-h-screen md:min-h-0 md:h-[850px] shadow-2xl flex flex-col relative md:rounded-[40px] md:border-[8px] border-red-800 overflow-hidden ring-4 ring-black">

                        

                        {/* Decoración Superior */}

                        <div className="absolute top-0 left-0 w-full h-24 bg-red-600 z-20 flex items-start p-4 shadow-md border-b-4 border-red-800">

                            <div className="w-16 h-16 rounded-full bg-blue-400 border-4 border-white shadow-[0_0_15px_rgba(59,130,246,0.6)] flex items-center justify-center relative overflow-hidden">

                                <div className="absolute top-2 left-3 w-4 h-4 bg-white rounded-full opacity-60 blur-[1px]"></div>

                            </div>

                            <div className="flex gap-2 ml-4 mt-1">

                                <div className="w-4 h-4 rounded-full bg-red-800 border-2 border-red-900 animate-pulse"></div>

                                <div className="w-4 h-4 rounded-full bg-yellow-400 border-2 border-yellow-600"></div>

                                <div className="w-4 h-4 rounded-full bg-green-500 border-2 border-green-700"></div>

                            </div>

                        </div>

                        {/* HEADER - TEXTO ELIMINADO SEGÚN PETICIÓN */}

                        <header className="absolute top-24 left-0 w-full px-6 py-2 flex justify-end items-center z-20">

                            {gameState === 'PLAYING' && (

                                <div className="flex gap-2">

                                    <button onClick={() => setGameState('SETTINGS')} className="p-2 bg-slate-800 rounded text-white border-2 border-slate-900 hover:bg-slate-700 shadow-md">

                                        <SVGIcons.Settings className="w-5 h-5" />

                                    </button>

                                    <button onClick={resetAll} className="p-2 bg-red-800 rounded text-white border-2 border-red-900 hover:bg-red-700 shadow-md">

                                        <SVGIcons.Trash2 className="w-5 h-5" />

                                    </button>

                                </div>

                            )}

                            {gameState === 'SETTINGS' && (

                                <button onClick={() => setGameState('PLAYING')} className="px-4 py-1 bg-blue-500 text-white font-bold border-2 border-blue-700 rounded shadow-[0_2px_0_#1e3a8a] active:translate-y-[2px] active:shadow-none text-sm font-pixel">

                                    VOLVER

                                </button>

                            )}

                        </header>

                        {/* PANTALLA PRINCIPAL */}

                        <main className="flex-grow flex flex-col mt-36 mx-4 mb-8 bg-white rounded-b-2xl rounded-tr-none rounded-tl-[40px] border-4 border-slate-700 relative z-10 overflow-hidden shadow-[inset_0_0_20px_rgba(0,0,0,0.2)]">

                            <div className="absolute inset-0 opacity-10 pointer-events-none" 

                                style={{backgroundImage: 'linear-gradient(0deg, transparent 24%, #000 25%, #000 26%, transparent 27%, transparent 74%, #000 75%, #000 76%, transparent 77%, transparent), linear-gradient(90deg, transparent 24%, #000 25%, #000 26%, transparent 27%, transparent 74%, #000 75%, #000 76%, transparent 77%, transparent)', backgroundSize: '30px 30px'}}>

                            </div>

                            <div className="relative z-10 w-full h-full flex flex-col p-4">

                                {gameState === 'SETUP' && <SetupScreen onGenerate={handleStartGeneration} Icons={SVGIcons} />}

                                {gameState === 'SETTINGS' && <ProbabilitySettings probabilities={probabilities} setProbabilities={setProbabilities} onClose={() => setGameState('PLAYING')} />}

                                {(gameState === 'PLAYING' || gameState === 'SCRATCHING' || gameState === 'RESULT') && (

                                    <GameScreenGacha

                                        jackpot={jackpot} 

                                        jackpotRevealed={jackpotRevealed}

                                        onDraw={drawTicket}

                                        isDrawing={isDrawing}

                                        Icons={SVGIcons}

                                    />

                                )}

                            </div>

                        </main>

                        

                        {/* Decoración Inferior */}

                        <div className="h-12 w-full flex justify-center items-center gap-8 pb-4 opacity-50">

                            <div className="w-24 h-6 bg-slate-900 rounded-full border border-slate-700"></div>

                            <div className="grid grid-cols-3 gap-1">

                                <div className="w-2 h-2 bg-slate-900 rounded-full"></div>

                                <div className="w-2 h-2 bg-slate-900 rounded-full"></div>

                                <div className="w-2 h-2 bg-slate-900 rounded-full"></div>

                            </div>

                        </div>

                        {/* OVERLAYS */}

                        {gameState === 'SCRATCHING' && currentTicket && (

                            <ScratchOverlay ticket={currentTicket} onFinish={finishScratch} getTicketTier={getTicketTier} />

                        )}

                        {gameState === 'RESULT' && currentTicket && (

                            <ResultModal ticket={currentTicket} onClose={closeResult} getTicketTier={getTicketTier} />

                        )}

                    </div>

                </div>

            );

        }

        function SetupScreen({ onGenerate, Icons }) {

            const [amount, setAmount] = useState('');

            return (

                <div className="flex flex-col items-center justify-center h-full animate-fade-in text-center px-2">

                    <div className="w-24 h-24 rounded-full bg-yellow-100 border-4 border-yellow-500 flex items-center justify-center mb-4 shadow-lg">

                        <Icons.BagOfCoins className="w-14 h-14" />

                    </div>

                    {/* CAMBIO DE TEXTO: LOTERÍA */}

                    <h2 className="text-3xl font-black text-slate-800 mb-2 uppercase tracking-tight">LOTERÍA</h2>

                    <p className="text-slate-500 text-sm mb-6 font-medium">Configura el Jackpot de Pokéonedas.</p>

                    <div className="w-full bg-slate-100 p-2 rounded-lg border-2 border-slate-300 mb-4">

                        <input 

                            type="number" 

                            value={amount}

                            onChange={(e) => setAmount(e.target.value)}

                            placeholder="Cantidad (100k - 1M)"

                            className="w-full bg-white border-2 border-slate-200 rounded-md p-3 text-2xl font-pixel text-center text-slate-700 outline-none focus:border-yellow-500 transition-colors"

                        />

                    </div>

                    <button 

                        onClick={() => { if (amount >= 100000 && amount <= 1000000) onGenerate(amount, false); }}

                        disabled={!amount || amount < 100000 || amount > 1000000}

                        className="w-full bg-slate-200 hover:bg-slate-300 text-slate-600 font-bold py-3 rounded-xl mb-3 border-b-4 border-slate-300 active:border-b-0 active:translate-y-1 transition-all disabled:opacity-50 text-sm uppercase"

                    >

                        Configurar Manual

                    </button>

                    

                    {/* CAMBIO DE TEXTO: GENERAR RANDOM */}

                    <button 

                        onClick={() => onGenerate(0, true)}

                        className="w-full bg-yellow-400 hover:bg-yellow-300 text-yellow-900 font-bold py-4 rounded-xl border-b-4 border-yellow-600 active:border-b-0 active:translate-y-1 transition-all flex items-center justify-center gap-2 uppercase tracking-wide shadow-md"

                    >

                        <Icons.Sparkles className="w-5 h-5" />

                        GENERAR RANDOM

                    </button>

                </div>

            );

        }

        function GameScreenGacha({ jackpot, jackpotRevealed, onDraw, isDrawing, Icons }) {

            const [knobAnim, setKnobAnim] = useState('');

            const [ticketEject, setTicketEject] = useState(false);

            useEffect(() => {

                if (isDrawing) {

                    setKnobAnim('animate-knob-spin');

                    // Sincronización para que el ticket salga cuando la perilla gira

                    setTimeout(() => setTicketEject(true), 600);

                    setTimeout(() => {

                        setKnobAnim('');

                        setTicketEject(false);

                    }, 1500);

                }

            }, [isDrawing]);

            return (

                <div className="flex flex-col h-full animate-fade-in items-center justify-between py-2">

                    

                    {/* PANEL SUPERIOR */}

                    <div className="w-full max-w-xs bg-slate-800 border-4 border-slate-600 rounded-lg p-3 mb-2 flex flex-col items-center shadow-lg relative overflow-hidden group">

                        <div className="absolute top-0 left-0 w-full h-1 bg-white/10"></div>

                        <span className="text-[10px] text-yellow-400 uppercase tracking-[0.2em] font-bold mb-1 font-pixel">BOTE ACUMULADO</span>

                        {/* LÓGICA DE DISPLAY JACKPOT */}

                        <div className={`text-3xl font-pixel tracking-widest ${jackpotRevealed ? 'text-yellow-300 animate-reveal drop-shadow-[0_0_5px_rgba(253,224,71,0.8)]' : 'text-green-500'}`}>

                            {jackpotRevealed ? `${jackpot.toLocaleString()}` : '??????'} <span className="text-sm">PK</span>

                        </div>

                    </div>

                    {/* MÁQUINA GACHA */}

                    <div className="relative w-full flex-grow flex flex-col items-center justify-center">

                        

                        <div className="relative w-48 h-48 rounded-full glass-dome z-10 overflow-hidden flex items-center justify-center mb-[-40px]">

                            <div className="absolute top-10 left-10 w-10 h-10 rounded-full capsule rotate-12 shadow-sm"></div>

                            <div className="absolute bottom-12 right-8 w-12 h-12 rounded-full capsule blue opacity-90 -rotate-12 shadow-sm"></div>

                            <div className="absolute top-16 right-14 w-8 h-8 rounded-full capsule yellow opacity-80 rotate-45 shadow-sm"></div>

                        </div>

                        {/* Cuerpo Máquina */}

                        <div className="w-44 h-36 bg-red-600 rounded-b-2xl pt-10 relative shadow-xl border-x-4 border-b-4 border-red-800 flex flex-col items-center z-20">

                            

                            {/* Máscara superior para ocultar origen del ticket */}

                            <div className="absolute top-0 w-full h-10 bg-red-600 z-10"></div> 

                            <div className="absolute top-0 w-full h-4 bg-black/10 z-20"></div>

                            {/* Perilla */}

                            <div className="relative w-16 h-16 rounded-full bg-white border-4 border-slate-200 shadow-md flex items-center justify-center z-30 mb-2">

                                <div className={`w-full h-2 bg-slate-200 absolute transform ${knobAnim}`}></div>

                                <div className={`h-full w-2 bg-slate-200 absolute transform ${knobAnim}`}></div>

                                <div className="w-8 h-8 rounded-full bg-white border-2 border-slate-200 relative z-10 shadow-inner flex items-center justify-center">

                                    <div className="w-4 h-4 rounded-full bg-red-500 opacity-20"></div>

                                </div>

                            </div>

                            {/* REJILLA DE SALIDA (SLOT) - ARREGLADA */}

                            <div className="relative w-32 h-4 ticket-slot rounded-full border border-slate-800 mt-2 flex justify-center">

                                {/* MÁSCARA CORREGIDA: Bloque rojo encima de la ranura para que no se vea el ticket salir desde "arriba" en el aire */}

                                <div className="ticket-slot-mask"></div>

                                {/* Ticket saliendo */}

                                <div className="absolute top-0 w-full h-24 overflow-visible flex justify-center z-10" style={{ pointerEvents: 'none' }}>

                                    {ticketEject && (

                                        <div className="w-20 h-12 bg-white border-2 border-slate-300 rounded shadow-md animate-ticket-eject flex items-center justify-center">

                                            <Icons.Ticket className="w-6 h-6 text-slate-400" />

                                            <span className="text-[8px] text-slate-400 font-pixel absolute bottom-1">???</span>

                                        </div>

                                    )}

                                </div>

                                {/* Tapa de la rejilla para ocultar el origen del ticket */}

                                <div className="absolute top-[-2px] w-[104%] h-2 bg-red-800 rounded-t-lg z-20"></div>

                            </div>

                        </div>

                    </div>

                    <button 

                        onClick={onDraw}

                        disabled={isDrawing}

                        className="w-full max-w-xs relative group mt-4 active:scale-95 transition-transform"

                    >

                        <div className="absolute inset-0 bg-slate-900 rounded-xl translate-y-2"></div>

                        <div className="relative bg-yellow-400 hover:bg-yellow-300 text-yellow-900 font-black uppercase tracking-widest py-4 rounded-xl border-4 border-yellow-600 flex items-center justify-center gap-2 text-xl shadow-[inset_0_2px_0_rgba(255,255,255,0.4)]">

                            {isDrawing ? 'GIRANDO...' : '¡OBTENER!'}

                        </div>

                    </button>

                </div>

            );

        }

        function ProbabilitySettings({ probabilities, setProbabilities, onClose }) {

            const [tempProbabilities, setTempProbabilities] = useState(probabilities);

            const total = Object.values(tempProbabilities).reduce((sum, prob) => sum + (parseFloat(prob) || 0), 0);

            const isValid = Math.abs(100 - total) < 0.01;

            const handleChange = (key, val) => {

                let v = parseFloat(val);

                if (isNaN(v) || v < 0) v = 0;

                if (v > 100) v = 100;

                setTempProbabilities(prev => ({ ...prev, [key]: v }));

            };

            return (

                <div className="flex flex-col h-full animate-fade-in bg-slate-50 rounded-lg p-2">

                    <h2 className="text-xl font-black mb-4 text-center text-slate-700 uppercase border-b-2 border-slate-200 pb-2">Probabilidades</h2>

                    

                    <div className={`p-3 mb-4 rounded-lg border-2 flex justify-between items-center font-bold ${isValid ? 'border-green-500 bg-green-50 text-green-700' : 'border-red-500 bg-red-50 text-red-700'}`}>

                        <span className="text-xs uppercase">Total Actual</span>

                        <span className="font-pixel text-xl">{total.toFixed(2)}%</span>

                    </div>

                    <div className="space-y-2 overflow-y-auto flex-grow pb-4 pr-1 scrollbar-thin">

                        {Object.keys(tempProbabilities).map((key) => (

                            <div key={key} className="bg-white p-2 rounded border border-slate-200 flex justify-between items-center shadow-sm">

                                <span className="text-sm font-bold text-slate-600">

                                    {key === 'JACKPOT' ? '★ JACKPOT' : key === '0' ? 'VACÍO' : `${parseInt(key).toLocaleString()} PK`}

                                </span>

                                <div className="flex items-center gap-2">

                                    <input

                                        type="number"

                                        step="0.1"

                                        value={tempProbabilities[key]}

                                        onChange={(e) => handleChange(key, e.target.value)}

                                        className="w-16 bg-slate-100 border border-slate-300 rounded p-1 text-right text-sm font-pixel focus:border-blue-500 outline-none"

                                    />

                                    <span className="text-xs text-slate-400">%</span>

                                </div>

                            </div>

                        ))}

                    </div>

                    <button 

                        onClick={() => { if(isValid) { setProbabilities(tempProbabilities); onClose(); } }}

                        disabled={!isValid}

                        className="w-full bg-blue-600 hover:bg-blue-500 disabled:bg-slate-400 text-white font-bold py-3 rounded-lg mt-4 border-b-4 border-blue-800 active:border-b-0 active:translate-y-1 transition-all uppercase"

                    >

                        {isValid ? 'Guardar Cambios' : 'Corregir %'}

                    </button>

                </div>

            );

        }

        function ScratchOverlay({ ticket, onFinish, getTicketTier }) {

            const canvasRef = useRef(null);

            const [isRevealed, setIsRevealed] = useState(false);

            

            const tier = getTicketTier(ticket.value);

            const IconComponent = tier.Icon;

            // Formateo del texto para rascar (Corrige 0K y 1K)

            const getDisplayText = () => {

                if(ticket.value === 'JACKPOT') return 'JACKPOT';

                if(ticket.value === 0) return 'VACÍO';

                if(ticket.amount < 1000) return `${ticket.amount} PK`; // 100 PK, 500 PK

                return `${(ticket.amount/1000).toFixed(0)}k PK`; // 1k, 3k, etc.

            };

            

            useEffect(() => {

                const canvas = canvasRef.current;

                if (!canvas) return;

                const ctx = canvas.getContext('2d');

                canvas.width = canvas.offsetWidth;

                canvas.height = canvas.offsetHeight;

                

                ctx.fillStyle = '#cbd5e1'; 

                ctx.fillRect(0, 0, canvas.width, canvas.height); 

                // Patrón de rasca

                ctx.fillStyle = '#94a3b8';

                for(let i=0; i<100; i++) {

                    ctx.fillRect(Math.random()*canvas.width, Math.random()*canvas.height, 2, 2);

                }

                

                // Texto

                ctx.fillStyle = '#475569';

                ctx.font = 'bold 24px Fredoka';

                ctx.textAlign = 'center';

                ctx.fillText('¡RASPA AQUÍ!', canvas.width/2, canvas.height/2 + 8);

                ctx.globalCompositeOperation = 'source-over';

            }, []);

            useEffect(() => {

                if (isRevealed) {

                    setTimeout(onFinish, 800); 

                }

            }, [isRevealed, onFinish]);

            const handleScratch = (e) => {

                if (isRevealed) return;

                const canvas = canvasRef.current;

                if (!canvas) return;

                const ctx = canvas.getContext('2d');

                const rect = canvas.getBoundingClientRect();

                

                const clientX = e.touches ? e.touches[0].clientX : e.clientX;

                const clientY = e.touches ? e.touches[0].clientY : e.clientY;

                const x = clientX - rect.left;

                const y = clientY - rect.top;

                ctx.globalCompositeOperation = 'destination-out';

                ctx.beginPath();

                ctx.arc(x, y, 30, 0, Math.PI * 2);

                ctx.fill();

                ctx.globalCompositeOperation = 'source-over';

                checkProgress(ctx, canvas);

            };

            const checkProgress = (ctx, canvas) => {

                if (isRevealed) return;

                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height).data;

                let transparentPixels = 0;

                for (let i = 3; i < imageData.length; i += 16) { 

                    if (imageData[i] === 0) transparentPixels++;

                }

                if ((transparentPixels / (imageData.length / 16)) > 0.4) setIsRevealed(true);

            };

            return (

                <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-6 animate-fade-in">

                    <div className="w-full max-w-sm bg-white border-4 border-slate-200 rounded-2xl overflow-hidden shadow-2xl relative animate-fly-in">

                        

                        <div className="bg-red-600 p-3 flex justify-between items-center border-b-4 border-red-800">

                            <span className="text-xs font-black text-white uppercase tracking-wider bg-red-800 px-2 py-1 rounded">Ticket #{ticket.number}</span>

                            <div className="flex gap-1">

                                <div className="w-2 h-2 rounded-full bg-white animate-pulse"></div>

                                <div className="w-2 h-2 rounded-full bg-white opacity-50"></div>

                            </div>

                        </div>

                        <div className="relative h-72 w-full bg-slate-50 p-4 flex items-center justify-center">

                            

                            {/* PREMIO */}

                            <div className={`absolute inset-4 rounded-xl flex flex-col items-center justify-center ${tier.color} shadow-inner`}>

                                <div className="w-28 h-28 mb-4 animate-scale-up">

                                    <IconComponent className="w-full h-full drop-shadow-md" />

                                </div>

                                <div className={`text-4xl font-black ${tier.textColor} font-pixel uppercase tracking-widest text-center leading-none`}>

                                    {getDisplayText()}

                                </div>

                            </div>

                            {/* CAPA RASPA */}

                            <canvas 

                                ref={canvasRef}

                                className={`absolute inset-4 w-[calc(100%-2rem)] h-[calc(100%-2rem)] rounded-xl cursor-crosshair touch-none transition-all duration-700 

                                            ${isRevealed ? 'opacity-0 scale-110 pointer-events-none' : 'opacity-100 shadow-lg'}`}

                                onMouseDown={(e) => { if (e.buttons === 1) handleScratch(e); }}

                                onMouseMove={(e) => { if (e.buttons === 1) handleScratch(e); }}

                                onTouchMove={handleScratch}

                                onTouchStart={handleScratch}

                            />

                        </div>

                    </div>

                </div>

            );

        }

        function ResultModal({ ticket, onClose, getTicketTier }) {

            const tier = getTicketTier(ticket.value);

            const isWin = ticket.amount > 0 || ticket.value === 'JACKPOT';

            const IconComponent = tier.Icon;

            return (

                <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/90 p-4 animate-scale-up backdrop-blur-md">

                    <div className="w-full max-w-sm rounded-3xl p-1 relative overflow-visible bg-white border-4 border-slate-900 shadow-[0_0_50px_rgba(255,215,0,0.3)]">

                        

                        {isWin && (

                            <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] bg-gradient-radial from-yellow-400/30 to-transparent rounded-full blur-xl animate-pulse pointer-events-none z-0"></div>

                        )}

                        <div className={`rounded-2xl p-6 text-center flex flex-col items-center relative z-10 ${isWin ? 'bg-yellow-50' : 'bg-slate-100'}`}>

                            

                            <h2 className={`text-xl font-black uppercase tracking-wider mb-6 px-6 py-2 rounded-full border-2 shadow-sm ${isWin ? 'bg-yellow-400 text-yellow-900 border-yellow-600' : 'bg-slate-300 text-slate-600 border-slate-400'}`}>

                                {isWin ? '¡POKÉONEDAS OBTENIDAS!' : '¡SUERTE LA PRÓXIMA!'}

                            </h2>

                            <div className="w-48 h-48 mb-6 relative">

                                {isWin && <div className="absolute inset-0 bg-yellow-400 rounded-full blur-3xl opacity-20 animate-pulse"></div>}

                                <IconComponent className="w-full h-full drop-shadow-2xl filter saturate-150 transform hover:scale-110 transition-transform duration-300" />

                            </div>

                            

                            {isWin ? (

                                <div className="mb-8">

                                    <div className={`text-6xl font-pixel ${tier.textColor} drop-shadow-sm font-bold`}>

                                        +{ticket.amount.toLocaleString()}

                                    </div>

                                    {/* SE ELIMINÓ: "+100 a tu monedero" */}

                                </div>

                            ) : (

                                <div className="mb-8 px-4">

                                    {/* CAMBIO DE TEXTO: Caja Vacía -> Sin premio */}

                                    <p className="text-slate-500 font-bold text-lg">Sin premio...</p>

                                </div>

                            )}

                            {/* CAMBIO DE TEXTO: Botón "REGRESAR" en todos los casos */}

                            <button onClick={onClose} className="w-full bg-blue-600 hover:bg-blue-500 text-white py-4 rounded-xl font-bold uppercase tracking-widest border-b-4 border-blue-800 active:border-b-0 active:translate-y-1 transition-all shadow-lg text-lg">

                                REGRESAR

                            </button>

                        </div>

                    </div>

                </div>

            );

        }

        const root = ReactDOM.createRoot(document.getElementById('root'));

        root.render(<App />);

    </script>

</body>

</html>

